var WWave=function(){"use strict";function t(t,e){return"string"==typeof t?(e||document).querySelector(t):t||null}function e(e,i,s){const a=document.createElement(e);for(let e in i)if("appendTo"===e){i.appendTo.appendChild(a)}else"innerHTML"===e?a.innerHTML=i.innerHTML:"width"===e||"height"===e?(a.style[e]=String(i[e]).indexOf("%")>-1?i[e]:i[e]+"px",a.setAttribute(e,i[e])):"x"===e?(a.style.left=i[e]+"px",a.setAttribute(e,i[e])):"y"===e?(a.style.top=i[e]+"px",a.setAttribute(e,i[e])):"styles"===e?t.styles(a,i[e]):a.setAttribute(e,i[e]);return s||a.classList.add("position-absolute"),a}t.on=((e,i,s,a)=>{a?t.delegate(e,i,s,a):(a=s,t.bind(e,i,a))}),t.off=((t,e,i)=>{t.removeEventListener(e,i)}),t.bind=((t,e,i)=>{e.split(/\s+/).forEach(function(e){t.addEventListener(e,i)})}),t.delegate=((t,e,i,s)=>{t.addEventListener(e,function(t){const e=t.target.closest(i);e&&(t.delegatedTarget=e,s.call(this,t,e))})}),t.closest=((e,i)=>i?i.matches(e)?i:t.closest(e,i.parentNode):null),t.attr=((e,i,s)=>{if(!s&&0!==s&&"string"==typeof i)return e.getAttribute(i);if("object"!=typeof i)"width"===i||"height"===i?e.style[i]=String(s).indexOf("%")>-1?s:s+"px":"x"===i?e.style.left=s+"px":"y"===i&&(e.style.top=s+"px"),e.setAttribute(i,s);else for(let s in i)t.attr(e,s,i[s])}),t.styles=((e,i,s)=>{if(!s&&0!==s&&"string"==typeof style)return e.style[i];if("object"!=typeof i)"number"==typeof s&&(s+="px"),e.style[i]=s;else for(let s in i)t.styles(e,s,i[s])}),t.deepClone=(e=>{if(!e&&"object"!=typeof e)throw new Error("error arguments","shallowClone");const i=e.constructor===Array?[]:{};for(const s in e)e.hasOwnProperty(s)&&(e[s]&&"object"==typeof e[s]?(i[s]=e[s].constructor===Array?[]:{},i[s]=t.deepClone(e[s])):i[s]=e[s]);return i}),t.objectMerge=((e,i)=>{if("object"!=typeof e&&(e={}),Array.isArray(i))return i.slice();for(const s in i)if(i.hasOwnProperty(s)){const a=i[s];if("object"==typeof a){e[s]=t.objectMerge(e[s],a);continue}e[s]=a}return e}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(t){var e=this;if(!document.documentElement.contains(e))return null;do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null});class i{constructor(t){this.setDefaults(t),this.setOptions(),this.setupWrapper(),this.render()}setDefaults(t){this.wwave=t,this.data=t.data,this.width=t.unitWidth,this.height=t.unitWidth,this.left=t.width/2-this.width/2,this.top=t.width/2-this.width/2}setOptions(){this.options={}}setupWrapper(){this.$element=e("div",{x:this.left,y:this.top,width:this.width,height:this.height,class:"w-core-ball"}),this.$img=e("img",{width:"100%",height:"100%",src:this.wwave.options.coreImg}),this.$element.appendChild(this.$img)}render(){}}class s{constructor({canvasWidth:t,canvasHeight:e,waveWidth:i=.055,waveHeight:s=6,xOffset:a=0,speed:h=.04,colors:n=["#DBB77A","#BF8F3B"]}={}){this.points=[],this.startX=0,this.canvasWidth=t,this.canvasHeight=e,this.waveWidth=i,this.waveHeight=s,this.xOffset=a,this.speed=h,this.colors=n}getChartColor(t){const e=this.canvasWidth/2,i=t.createLinearGradient(e,e,e,this.canvasHeight);return i.addColorStop(0,this.colors[0]),i.addColorStop(1,this.colors[1]),i}draw(t){t.save();const e=this.points;t.beginPath();for(let i=0;i<e.length;i+=1){const s=e[i];t.lineTo(s[0],s[1])}t.lineTo(this.canvasWidth,this.canvasHeight),t.lineTo(this.startX,this.canvasHeight),t.lineTo(e[0][0],e[0][1]),t.fillStyle=this.getChartColor(t),t.fill(),t.restore()}update({nowRange:t}={}){this.points=[];const{startX:e,waveHeight:i,waveWidth:s,canvasWidth:a,canvasHeight:h,xOffset:n}=this;for(let o=e;o<e+a;o+=20/a){const a=Math.sin((e+o)*s+n),r=h*(1-t/100);this.points.push([o,r+a*i])}this.xOffset+=this.speed}}var a={run(t){const e=t,i=e.getContext("2d"),s=window.devicePixelRatio||1,a=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,h=s/a;if(s!==a){const t=e.width,s=e.height;e.width=t*h,e.height=s*h,e.style.width=`${t}px`,e.style.height=`${s}px`,i.scale(h,h)}}};class h{constructor(t){this.setDefaults(t),this.resize()}setDefaults(i){this.options=t.objectMerge({width:300,height:300,rangeValue:50,colors:[["#4AA5D8","#439FD5"],["#2A86C7","#6CA8DB"]]},i),this.id="CANVAS"+String(Math.random()).replace(/\.|0/g,""),this.isDrawContainer=!1,this.$element=e("canvas",{class:"w-water-wave"},!0)}resize(){const t=this.$element;t.height=this.options.height,t.width=this.options.width,this.canvas=t,this.canvasWidth=t.width,this.canvasHeight=t.height,this.radius=this.canvasWidth/2,a.run(t),this.nowRange=0,this.rangeValue=this.options.rangeValue,this.wave1=new s({canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight,waveWidth:.055,waveHeight:4,colors:this.options.colors[0],xOffset:0,speed:.04}),this.wave2=new s({canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight,waveWidth:.04,waveHeight:3,colors:this.options.colors[1],xOffset:2,speed:.02}),this.draw()}draw(){const t=this.canvas.getContext("2d");if(t.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.isDrawContainer||this.drawContainer(t),this.nowRange<=this.rangeValue&&(this.nowRange+=1),this.nowRange>this.rangeValue&&(this.nowRange-=1),this.wave2.update({nowRange:this.nowRange}),this.wave2.draw(t),this.wave1.update({nowRange:this.nowRange}),this.wave1.draw(t),!document.querySelector(".w-wave"))return Object.keys(window.WWaveTimers).forEach(t=>{window.cancelAnimationFrame(window.WWaveTimers[t])}),window.WWaveTimers={},!1;window.WWaveTimers[this.id]=window.requestAnimationFrame(this.draw.bind(this))}drawContainer(t){const e=this.options.type;"circle"===e?this.drawCircle(t):"star"===e?this.drawStar(t):"roundRect"===e?this.drawRoundRect(t):"heart"===e&&this.drawHeart(t)}drawBackground(t){const e=this.radius,i=e;t.beginPath(),t.arc(e,e,i,0,2*Math.PI);const s=t.createRadialGradient(e,e,e/2,e,e,e);s.addColorStop(0,"rgba(127, 57, 242, 0"),s.addColorStop(1,"rgba(255, 195, 103, 0.11)"),t.fillStyle=s,t.fill()}drawCircle(t){const e=this.canvasWidth/2,i=e;t.lineWidth=4,t.beginPath(),t.arc(e,e,i,0,2*Math.PI),t.clip(),this.isDrawContainer=!0}drawStar(t,e=70,i=140,s=145,a=160){t.beginPath(),t.strokeStyle="rgba(186, 165, 130, 0.3)",t.lineWidth=2;for(let h=0;h<5;h+=1)t.lineTo(Math.cos((18+72*h)/180*Math.PI)*i+s,-Math.sin((18+72*h)/180*Math.PI)*i+a),t.lineTo(Math.cos((54+72*h)/180*Math.PI)*e+s,-Math.sin((54+72*h)/180*Math.PI)*e+a);t.closePath(),t.stroke(),t.clip(),this.isDrawContainer=!0}drawRoundRect(t,e=10,i=10,s=100,a=250){t.beginPath(),t.rect(e,i,s,a),t.strokeStyle="rgba(186, 165, 130, 0.3)",t.lineWidth=2;let h=s/2;a-s<0&&(h=a/2),t.beginPath(),t.arc(e+h,i+h,h,Math.PI,3*Math.PI/2),t.lineTo(s-h+e,i),t.arc(s-h+e,h+i,h,3*Math.PI/2,2*Math.PI),t.lineTo(s+e,a+i-h),t.arc(s-h+e,a-h+i,h,0,1*Math.PI/2),t.lineTo(h+e,a+i),t.arc(h+e,a-h+i,h,1*Math.PI/2,Math.PI),t.closePath(),t.stroke(),t.clip(),this.isDrawContainer=!0}drawHeart(t,e=150,i=130,s=9){const a=[];for(let t=0;t<50;t+=1){const e=t/50*(2*Math.PI),i={x:s*(16*Math.pow(Math.sin(e),3)),y:s*(13*Math.cos(e)-5*Math.cos(2*e)-2*Math.cos(3*e)-Math.cos(4*e))};a.push(i)}t.save(),t.beginPath(),t.translate(e,i),t.rotate(Math.PI);for(let e=0;e<50;e+=1){const i=a[e];t.lineTo(i.x,i.y)}t.strokeStyle="rgba(186, 165, 130, 0.3)",t.lineWidth=2,t.stroke(),t.restore(),t.clip(),this.isDrawContainer=!0}drawSin(t,e=0,i=0){const s=[],a=this.canvasWidth,h=this.canvasHeight;t.beginPath(),t.lineWidth=1;for(let n=0;n<0+a;n+=20/a){const a=4*Math.sin(.05*(0+n)+e);s.push([n,(1-i)*h+a]),t.lineTo(n,(1-i)*h+a)}t.lineTo(a,h),t.lineTo(0,h),t.lineTo(s[0][0],s[0][1]);const n=a/2,o=t.createLinearGradient(n,n,n,h);o.addColorStop(0,"#F39C6B"),o.addColorStop(1,"#A0563B"),t.fillStyle=o,t.fill()}}class n{constructor(t,e){this.make(t,e)}make(i,s){this.wwave=s,this.$element=e("div",{class:"w-wave-popup"}),t.on(this.$element,"click",t=>{t.stopPropagation()}),i.appendChild(this.$element),this.hide()}show(e,i){(e=t.objectMerge({title:"标题",rangeValue:0},e)).customHtml?this.$element.innerHTML=e.customHtml+'<div class="w-wave-popup-pointer"></div>':this.$element.innerHTML=`\n        <div class="w-wave-title">${e.title}</div>\n        <div class="w-wave-subtitle">${e.subTitle?e.subTitle:"占比:"+e.rangeValue+"%"}</div>\n        <div class="w-wave-popup-pointer"></div>\n      `;let s=t.closest(".w-sub-ball-item",i.target);this.$element.style.display="inline-block",this.width=this.$element.offsetWidth,this.height=this.$element.offsetHeight,this.$element.classList.remove("w-wave-popup-left","w-wave-popup-right","w-wave-popup-bottom");let a=window.innerWidth-(i.clientX+(s.offsetWidth-i.offsetX));this.width>a?(this.$element.style.right=this.wwave.width-Number(s.getAttribute("x"))+10+"px",this.$element.style.top=Number(s.getAttribute("y"))+5+"px",this.$element.classList.add("w-wave-popup-left")):(this.$element.style.left=Number(s.getAttribute("x"))+Number(s.offsetWidth)+10+"px",this.$element.style.top=Number(s.getAttribute("y"))+5+"px",this.$element.classList.add("w-wave-popup-right"));let h=window.innerHeight-(i.clientY-i.offsetY);this.height>h&&(this.$element.style.top="auto",this.$element.style.bottom=this.wwave.height-(Number(s.getAttribute("y"))+Number(s.offsetHeight)-20)+"px",this.$element.classList.add("w-wave-popup-bottom"))}hide(){this.$element.style.display="none"}}class o{constructor(t){this.setupWrapper(),this.setDefaults(t),this.render()}setDefaults(t){this.wwave=t,this.data=t.data,this.length=t.data.length,this.width=t.unitWidth,this.height=t.unitWidth,this.distance=t.width/3.2,this.popup=new n(this.$element,this.wwave)}getPolygonSpot(t,e,i){let s=[];for(let a=0;a<e;a++)s.push([t*Math.cos(2*Math.PI*a/e)+i.x,t*Math.sin(2*Math.PI*a/e)+i.y]);return s}setupWrapper(){this.$element=e("div",{x:0,y:0,class:"w-sub-ball"})}render(){this.makeupCircular(),this.makeupLines()}makeupCircular(){this.circulars=[];let i=this.wwave.data.length;i&&(this.polygonSpots=this.getPolygonSpot(this.distance,i,{x:this.wwave.coreBall.left,y:this.wwave.coreBall.top}),this.wwave.data.forEach((i,s)=>{this.circulars[s]=e("div",{x:this.polygonSpots[s][0],y:this.polygonSpots[s][1],width:this.width,height:this.height,class:"w-sub-ball-item"});let a=new h({width:this.width+20,height:this.height,type:"circle",rangeValue:i.rangeValue,colors:this.wwave.options.ball.subBall.colors},this.wwave.timers);this.$wave=e("div",{width:this.width,height:this.height,class:"w-sub-ball-item-wave"}),this.$wave.appendChild(a.$element),this.circulars[s].appendChild(this.$wave),this.$img=e("img",{src:i.img,class:"w-sub-ball-item-img"}),this.circulars[s].appendChild(this.$img),this.$text=e("div",{innerHTML:i.name+","+i.rangeValue+"%",class:"w-sub-ball-item-text"}),this.circulars[s].appendChild(this.$text),this.$element.appendChild(this.circulars[s]),t.on(this.circulars[s],"click",t=>{this.popup.hide();let e={};i.popupData&&i.popupData.length&&this.wwave.options.popup.formatPopupData&&(e=this.wwave.options.popup.formatPopupData(i)),this.popup.show({title:i.name,rangeValue:i.rangeValue,...e},t),t.stopPropagation()})}),this.bindHidePopupEvent())}bindHidePopupEvent(){function e(){this.popup.hide()}t.off(document.querySelector("body"),"click",e.bind(this)),t.on(document.querySelector("body"),"click",e.bind(this))}makeupLines(){if(this.polygonSpots&&this.polygonSpots.length){this.$lines=e("canvas",{class:"w-water-lines"},!0),this.$lines.width=this.wwave.width,this.$lines.height=this.wwave.height;let t=this.$lines.getContext("2d");t.strokeStyle=this.wwave.options.ball.lineColor,t.lineWidth=this.wwave.options.ball.lineWidth;let i=this.wwave.width/2;for(let e of this.polygonSpots)t.moveTo(i,i),t.lineTo(e[0]+this.width/2,e[1]+this.width/2);t.stroke(),this.$element.appendChild(this.$lines)}}}return class{constructor(t,e,i){this.setupWrapper(t),this.setupOptions(e),this.setupData(i),this.setTimers(),this.render()}setupWrapper(t){if("string"==typeof t&&(t=document.querySelector(t)),!(t instanceof HTMLElement))throw new TypeError("请添加选择器！");this.$element=e("div",{class:"w-wave"},!0),t.appendChild(this.$element),this.$wrapper=t}setupOptions(e){this.options=t.objectMerge({ball:{boreBall:{},subBall:{colors:[["#4AA5D8","#439FD5"],["#2A86C7","#6CA8DB"]]},lineWidth:3,lineColor:"#ddd"},popup:{}},e)}setupData(t){this.data=t||[]}setTimers(){window.WWaveTimers={}}refresh(){this.render()}render(){this.clear(),this.setWrapperSize(),this.makeupBall()}clear(){Object.keys(window.WWaveTimers).length&&(Object.keys(window.WWaveTimers).forEach(t=>{window.cancelAnimationFrame(window.WWaveTimers[t])}),window.WWaveTimers={}),this.$element.innerHTML=""}setWrapperSize(){this.width=this.$wrapper.offsetHeight,this.height=this.$wrapper.offsetHeight,t.attr(this.$element,{width:this.width,height:this.height}),this.unitWidth=this.data.length?this.width/Math.max(this.data.length,5.7)/.8:0}makeupBall(){this.makeupCoreBall(),this.makeupSubBall()}makeupCoreBall(){this.coreBall=new i(this),this.$element.appendChild(this.coreBall.$element)}makeupSubBall(){const t=new o(this);this.$element.appendChild(t.$element)}}}();
